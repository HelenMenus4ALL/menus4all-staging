<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Menus4ALL | Accessible Restaurant Menus for Everyone</title>


    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Access restaurant menus designed for people with visual impairments. Free accessible menus with text resizing and screen reader support. Menus4ALL is a project of Modern Technology for the Blind, 501 (c)(3)">
    <meta name="theme-color" content="#884b05">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Menus4ALL">
    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- External Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    <script src="js/ga-production.js"></script>
    <!-- Mobile Menu Script -->
    <script src="/mobile-menu.js"></script>
    <!-- Global component styles (for header/footer) -->
    <link rel="stylesheet" href="global-styles.css">
    
    <style>
        /* ============================================ */
        /* MOBILE NAVIGATION - ADDED FOR ACCESSIBILITY */
        /* CRITICAL: These styles override styles.css mobile nav */
        /* ============================================ */
        
        /* Force desktop nav to always be visible on desktop, hidden on mobile */
        .main-nav {
            display: none !important;
        }
        
        @media (min-width: 768px) {
            .main-nav {
                display: flex !important;
                position: static !important;
                flex-direction: row !important;
                background: transparent !important;
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
            }
            
            /* Ensure mobile navigation is hidden on desktop */
            .mobile-nav-container {
                display: none !important;
            }
            
            .menu-toggle {
                display: none !important;
            }
        }
        
        /* Remove the old .active class behavior */
        .main-nav.active {
            display: none !important;
        }
        
        /* Mobile Navigation Container - slides in from right */
        .mobile-nav-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            overflow-y: auto;
        }
        
        .mobile-nav-container[data-visible="true"] {
            display: block !important;
        }
        
        .mobile-nav-content {
            background: #fff;
            width: 85%;
            max-width: 400px;
            height: 100%;
            margin-left: auto;
            box-shadow: -2px 0 8px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        
        /* Mobile Nav Header */
        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 2px solid #ddd;
            background: #f9f9f9;
        }
        
        .mobile-nav-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #884b05;
            margin: 0;
        }
        
        /* Close button (X) in header */
        .close-menu-btn {
            background: #000;
            border: 2px solid #000;
            color: white;
            cursor: pointer;
            font-weight: 700;
            min-width: 44px;
            min-height: 44px;
            padding: 8px;
            font-size: 1.5rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .close-menu-btn:hover,
        .close-menu-btn:focus {
            background: #333;
            border-color: #333;
        }
        
        /* Focus sentinels - invisible but focusable to trap focus */
        .focus-sentinel-start,
        .focus-sentinel-end {
            width: 1px;
            height: 1px;
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }
        
        /* Help notice at bottom of menu */
        .menu-help-notice {
            padding: 1rem;
            border-top: 2px solid #ddd;
            background: #f0f0f0;
            margin-top: auto;
        }
        
        .close-menu-btn-alt {
            background: #000;
            border: 2px solid #000;
            color: white;
            cursor: pointer;
            font-weight: 700;
            width: 100%;
            min-height: 50px;
            padding: 12px;
            font-size: 1.1rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-menu-btn-alt:hover,
        .close-menu-btn-alt:focus {
            background: #333;
            border-color: #333;
        }
        
        /* Mobile Navigation Links */
        .mobile-nav-links {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0.5rem;
            gap: 0.5rem;
            overflow-y: auto;
        }
        
        .mobile-nav-links a {
            display: block;
            padding: 1rem;
            color: #000;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .mobile-nav-links a:hover,
        .mobile-nav-links a:focus {
            background-color: #f5f5f5;
            color: #884b05;
        }
        
        /* ============================================ */
        /* iOS PWA BANNER FIX */
        /* ============================================ */
        
        /* Add safe area padding for iOS PWA banner */
        @supports (-webkit-touch-callout: none) {
            body {
                padding-top: 60px;
                padding-top: max(60px, env(safe-area-inset-top));
                padding-left: 0;
                padding-right: 0;
            }
        }
        
        /* Smooth transition when banner appears/disappears */
        body {
            transition: padding-top 0.3s ease;
            margin: 0;
            padding-left: 0;
            padding-right: 0;
        }
        
        /* ============================================ */
        /* TEXT SCALING OVERFLOW FIXES */
        /* ============================================ */
        
        /* Ensure all containers respect viewport width */
        * {
            box-sizing: border-box;
        }
        
        html {
            overflow-x: hidden;
            width: 100%;
        }
        
        body {
            overflow-x: hidden;
            max-width: 100vw;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* Fix main content containers */
        .container {
            max-width: 1200px !important;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: 20px;
            padding-right: 20px;
        }
        
        /* CRITICAL FIX: Ensure container maintains proper width at ALL text sizes */
        /* This prevents the main content from expanding to 100% width when text is scaled */
        body.text-size-125 .container,
        body.text-size-150 .container,
        body.text-size-200 .container,
        body.text-size-125 main.container,
        body.text-size-150 main.container,
        body.text-size-200 main.container {
            max-width: 1200px !important;
            width: 100% !important;
        }
        
        /* CRITICAL FIX: Ensure footer-container maintains proper width at ALL text sizes */
        /* This keeps the footer content centered and matching the main content width */
        body.text-size-125 .footer-container,
        body.text-size-150 .footer-container,
        body.text-size-200 .footer-container {
            max-width: 1200px !important;
            width: 100% !important;
        }
        
        /* CRITICAL FIX: Ensure CTA buttons container stays FULL WIDTH at all text sizes */
        /* The brown bar should extend edge-to-edge */
        body.text-size-125 .cta-buttons,
        body.text-size-150 .cta-buttons,
        body.text-size-200 .cta-buttons {
            max-width: 100% !important;
            width: 100% !important;
        }
        
        /* Note: main element uses .container class which has max-width: 1200px */
        /* Only apply 100% max-width to sections to prevent overflow */
        section {
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        /* Fix headings - prevent overflow */
        h1, h2, h3, h4, h5, h6 {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }
        
        /* Specific fix for the "Looking for a menu nearby?" heading */
        .section-heading {
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            hyphens: auto !important;
            max-width: 100% !important;
        }
        
        /* Fix for hero section */
        .hero-banner {
            max-width: 100%;
            width: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        .hero-banner-image {
            max-width: 100%;
            width: 100%;
            height: auto;
            display: block;
        }
        
        /* Fix CTA buttons container - FULL WIDTH brown bar */
        .cta-buttons {
            max-width: 100% !important; /* Full width */
            width: 100% !important;
            margin: 0 !important;
            padding: 1rem 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            box-sizing: border-box;
        }
        
        .cta-btn {
            word-wrap: break-word;
            white-space: normal;
            flex: 0 1 auto; /* Don't grow, allow shrink, auto width */
            min-width: 200px; /* Minimum button width */
            max-width: 350px; /* Maximum button width */
        }
        
        /* Fix location section with button */
        .location-section {
            max-width: 100%;
            overflow-wrap: break-word;
        }
        
        .location-section h2 {
            display: block !important; /* Override inline-block */
            margin-right: 0 !important;
            margin-bottom: 1rem;
            max-width: 100%;
        }
        
        .location-section button {
            display: block !important; /* Override inline-block */
            margin-top: 1rem;
            max-width: 100%;
            white-space: normal;
            word-wrap: break-word;
        }
        
        /* Fix accordion titles */
        .accordion {
            max-width: 100%;
            word-wrap: break-word;
            white-space: normal;
            padding-right: 50px; /* Space for chevron */
        }
        
        .accordion h2 {
            display: inline;
            word-wrap: break-word;
            white-space: normal;
            max-width: calc(100% - 50px); /* Account for chevron */
        }
        
        /* Fix panels */
        .panel {
            max-width: 100%;
            overflow-wrap: break-word;
        }
        
        /* Fix search section */
        .search-section {
            max-width: 100%;
        }
        
        .search-box {
            max-width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .search-box > div {
            flex: 1 1 100%;
            min-width: 0;
        }
        
        .search-box input {
            max-width: 100%;
            box-sizing: border-box;
        }
        
        /* Fix buttons to wrap text */
        .btn {
            white-space: normal;
            word-wrap: break-word;
            max-width: 100%;
            line-height: 1.4;
            padding: 12px 20px;
        }
        
        /* ============================================ */
        /* LOAD MORE BUTTON STYLES */
        /* ============================================ */
        .load-more-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            max-width: 400px;
            margin: 2rem auto 1rem auto;
            padding: 1rem 2rem;
            background-color: #884b05;
            color: white;
            border: 2px solid #884b05;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 54px;
        }
        
        .load-more-btn:hover,
        .load-more-btn:focus {
            background-color: #6a3a04;
            border-color: #6a3a04;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(136, 75, 5, 0.3);
        }
        
        .load-more-btn:focus {
            outline: 3px solid #ffc107;
            outline-offset: 2px;
        }
        
        .load-more-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        .load-more-btn svg {
            flex-shrink: 0;
        }
        
        /* High contrast mode for Load More button */
        body.high-contrast .load-more-btn {
            background-color: #000;
            border-color: #fff;
            color: #fff;
        }
        
        body.high-contrast .load-more-btn:hover,
        body.high-contrast .load-more-btn:focus {
            background-color: #fff;
            color: #000;
        }
        
        /* Fix restaurant cards */
        .restaurant-list {
            max-width: 100%;
        }
        
        .restaurant-card {
            max-width: 100%;
            overflow: hidden;
        }
        
        .restaurant-card-content {
            max-width: 100%;
            overflow-wrap: break-word;
        }
        
        .restaurant-card h3,
        .restaurant-card p,
        .restaurant-card a {
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 767px) {
            /* Force single column on mobile */
            .restaurant-list {
                grid-template-columns: 1fr !important;
            }
            
            /* Adjust accordion padding for smaller screens */
            .accordion {
                padding: 16px 16px 16px 45px;
                font-size: 1.5rem;
            }
            
            /* Make sure buttons take full width on mobile when text is large */
            body.text-size-200 .cta-btn,
            body.text-size-200 .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            /* Reduce grid gap on mobile when text is large */
            body.text-size-200 .cta-buttons {
                gap: 0.5rem;
            }
        }
        
        /* Specific fixes for enlarged text sizes */
        body.text-size-150 .section-heading,
        body.text-size-200 .section-heading {
            font-size: clamp(1.5rem, 5vw, 4rem) !important;
        }
        
        body.text-size-150 .accordion,
        body.text-size-200 .accordion {
            font-size: clamp(1.2rem, 4vw, 2.5rem) !important;
            line-height: 1.3;
        }
        
        /* CRITICAL FIX: Target content elements but NOT structural containers */
        /* This prevents horizontal scroll while preserving layout container widths */
        body.text-size-125 h1, body.text-size-125 h2, body.text-size-125 h3, 
        body.text-size-125 h4, body.text-size-125 h5, body.text-size-125 h6,
        body.text-size-125 p, body.text-size-125 a, body.text-size-125 span,
        body.text-size-125 button, body.text-size-125 input, body.text-size-125 div:not(.container):not(.cta-buttons),
        body.text-size-150 h1, body.text-size-150 h2, body.text-size-150 h3,
        body.text-size-150 h4, body.text-size-150 h5, body.text-size-150 h6,
        body.text-size-150 p, body.text-size-150 a, body.text-size-150 span,
        body.text-size-150 button, body.text-size-150 input, body.text-size-150 div:not(.container):not(.cta-buttons),
        body.text-size-200 h1, body.text-size-200 h2, body.text-size-200 h3,
        body.text-size-200 h4, body.text-size-200 h5, body.text-size-200 h6,
        body.text-size-200 p, body.text-size-200 a, body.text-size-200 span,
        body.text-size-200 button, body.text-size-200 input, body.text-size-200 div:not(.container):not(.cta-buttons) {
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        /* Override any inline styles that might cause issues */
        [style*="display: inline-block"] {
            word-wrap: break-word !important;
        }
        
        /* ============================================ */
        /* YOUR EXISTING TEXT RESIZE STYLES BELOW */
        /* ============================================ */
        /* Text Resize Feature */
        
        /* Sticky Header */
        .site-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Text Size Controls */
        .text-size-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .size-display {
            min-width: 60px;
            text-align: center;
            font-weight: 700;
            color: #884b05;
            font-size: 1.25rem;
        }
        
        /* Style for A+ and A- buttons */
        .size-btn {
            background: #884b05 !important;
            border: 2px solid #884b05 !important;
            color: white !important;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            min-width: 44px;
            min-height: 44px;
            padding: 8px;
            font-size: 1.25rem !important;
            border-radius: 4px;
        }
        
        .size-btn:hover,
        .size-btn:focus {
            background: #6b3a04 !important;
            border-color: #6b3a04 !important;
            color: white !important;
            transform: scale(1.05);
        }
        
        /* Reset button - different styling */
        .reset-button {
            background: #000;
            border: 2px solid #000;
            color: white;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            min-width: 70px;
            min-height: 44px;
            padding: 8px 16px;
            font-size: 1rem;
            border-radius: 4px;
        }
        
        .reset-button:hover,
        .reset-button:focus {
            background: #333;
            border-color: #333;
            transform: scale(1.05);
        }
        
        /* Text Size Classes - NEW SYSTEM (old 150% is now default)
           100% = 24px (was old 150%)
           125% = 32px (was old 200%)
           150% = 36px (new)
           200% = 48px (new)
        */
        body { font-size: 24px; }
        body.text-size-125 { font-size: 32px; }
        body.text-size-150 { font-size: 36px; }
        body.text-size-200 { font-size: 48px; }
        
        /* Scale headings proportionally */
        body.text-size-125 h1 { font-size: 3.75rem; }
        body.text-size-150 h1 { font-size: 4.25rem; }
        body.text-size-200 h1 { font-size: 5.5rem; }
        
        body.text-size-125 h2 { font-size: 3rem; }
        body.text-size-150 h2 { font-size: 3.5rem; }
        body.text-size-200 h2 { font-size: 4.5rem; }
        
        body.text-size-125 .section-heading { font-size: 3rem !important; }
        body.text-size-150 .section-heading { font-size: 3.5rem !important; }
        body.text-size-200 .section-heading { font-size: 4.5rem !important; }
        
        /* Scale accordion buttons */
        body.text-size-125 .accordion { font-size: 2.25rem !important; }
        body.text-size-150 .accordion { font-size: 2.5rem !important; }
        body.text-size-200 .accordion { font-size: 3.25rem !important; }
        
        body.text-size-125 .accordion h2 { font-size: 2.25rem !important; }
        body.text-size-150 .accordion h2 { font-size: 2.5rem !important; }
        body.text-size-200 .accordion h2 { font-size: 3.25rem !important; }
        
        /* Scale form elements */
        body.text-size-125 .suggest-menu-form h3 { font-size: 2.25rem !important; }
        body.text-size-150 .suggest-menu-form h3 { font-size: 2.5rem !important; }
        body.text-size-200 .suggest-menu-form h3 { font-size: 3.25rem !important; }
        
        body.text-size-125 .suggest-menu-form label,
        body.text-size-125 .suggest-menu-form input,
        body.text-size-125 .suggest-menu-form textarea,
        body.text-size-125 .suggest-menu-form button,
        body.text-size-125 .search-box label,
        body.text-size-125 .search-box input { font-size: 1.35rem !important; }
        
        body.text-size-150 .suggest-menu-form label,
        body.text-size-150 .suggest-menu-form input,
        body.text-size-150 .suggest-menu-form textarea,
        body.text-size-150 .suggest-menu-form button,
        body.text-size-150 .search-box label,
        body.text-size-150 .search-box input { font-size: 1.5rem !important; }
        
        body.text-size-200 .suggest-menu-form label,
        body.text-size-200 .suggest-menu-form input,
        body.text-size-200 .suggest-menu-form textarea,
        body.text-size-200 .suggest-menu-form button,
        body.text-size-200 .search-box label,
        body.text-size-200 .search-box input { font-size: 2rem !important; }
        
        /* Scale CTA buttons and other buttons */
        body.text-size-125 .cta-btn,
        body.text-size-125 .btn,
        body.text-size-125 .cta-buttons button { font-size: 1.5rem !important; }
        body.text-size-150 .cta-btn,
        body.text-size-150 .btn,
        body.text-size-150 .cta-buttons button { font-size: 1.75rem !important; }
        body.text-size-200 .cta-btn,
        body.text-size-200 .btn,
        body.text-size-200 .cta-buttons button { font-size: 2.25rem !important; }
        
        /* Scale accordion panel content - all text */
        body.text-size-125 .panel * { font-size: 1.35rem !important; }
        body.text-size-150 .panel * { font-size: 1.5rem !important; }
        body.text-size-200 .panel * { font-size: 2rem !important; }
        
        /* Override for panel headings */
        body.text-size-125 .panel h3,
        body.text-size-125 .panel h4 { font-size: 1.75rem !important; }
        body.text-size-150 .panel h3,
        body.text-size-150 .panel h4 { font-size: 2rem !important; }
        body.text-size-200 .panel h3,
        body.text-size-200 .panel h4 { font-size: 2.5rem !important; }
        
        /* Scale restaurant cards */
        body.text-size-125 .restaurant-card h3 { font-size: 1.8rem !important; }
        body.text-size-150 .restaurant-card h3 { font-size: 2rem !important; }
        body.text-size-200 .restaurant-card h3 { font-size: 2.5rem !important; }
        
        body.text-size-125 .restaurant-card p,
        body.text-size-125 .restaurant-card a { font-size: 1.35rem !important; }
        body.text-size-150 .restaurant-card p,
        body.text-size-150 .restaurant-card a { font-size: 1.5rem !important; }
        body.text-size-200 .restaurant-card p,
        body.text-size-200 .restaurant-card a { font-size: 2rem !important; }
        
        /* Scale restaurant category text */
        body.text-size-125 .restaurant-category { font-size: 1.35rem !important; }
        body.text-size-150 .restaurant-category { font-size: 1.5rem !important; }
        body.text-size-200 .restaurant-category { font-size: 2rem !important; }
        
        /* Scale dietary badges */
        body.text-size-125 .dietary-badge { font-size: 1.125rem !important; }
        body.text-size-150 .dietary-badge { font-size: 1.25rem !important; }
        body.text-size-200 .dietary-badge { font-size: 1.625rem !important; }
        
        /* Scale distance badge */
        body.text-size-125 .distance { font-size: 1.35rem !important; }
        body.text-size-150 .distance { font-size: 1.5rem !important; }
        body.text-size-200 .distance { font-size: 2rem !important; }
        
        /* Scale footer */
        body.text-size-125 footer,
        body.text-size-125 footer * { font-size: 1.35rem !important; }
        body.text-size-150 footer,
        body.text-size-150 footer * { font-size: 1.5rem !important; }
        body.text-size-200 footer,
        body.text-size-200 footer * { font-size: 2rem !important; }
        
        /* DO NOT scale navigation links */
        .main-nav a,
        .logo-text,
        .header-controls button {
            font-size: 1rem !important;
        }
        
        /* Restaurant List Styling - Mobile First */
        .restaurant-list {
            list-style: none;
            padding: 0;
            margin: 2rem 0;
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        /* 2 columns on tablets and desktop */
        @media (min-width: 768px) {
            .restaurant-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }
        }
        
        .restaurant-card {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            position: relative;
        }
        
        .restaurant-card-image {
            width: 100%;
            height: 200px;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        .restaurant-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .restaurant-card-content {
            padding: 1.5rem;
        }
        
        .favorite-btn {
            position: absolute;
            top: 216px; /* 200px image height + 16px (1rem) padding */
            right: 1rem;
            background: white;
            border: 2px solid #333;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .favorite-btn:hover {
            transform: scale(1.1);
            border-color: #e74c3c;
        }
        
        .favorite-btn:focus-visible {
            outline: 3px solid #884b05;
            outline-offset: 2px;
        }
        
        /* Heart SVG - default shows outlined heart */
        .favorite-btn svg {
            width: 24px;
            height: 24px;
            fill: none;
            stroke: #333;
            stroke-width: 2;
            transition: all 0.2s;
        }
        
        /* When favorited - filled red heart, no slash */
        .favorite-btn.is-favorite svg {
            fill: #e74c3c;
            stroke: #e74c3c;
        }
        
        /* Slash line - only visible when NOT favorited */
        .favorite-btn .slash-line {
            stroke: #333;
            stroke-width: 2.5;
            opacity: 1;
            transition: opacity 0.3s;
        }
        
        /* Hide slash when favorited */
        .favorite-btn.is-favorite .slash-line {
            opacity: 0;
        }
        
        .favorite-btn:hover svg {
            stroke: #e74c3c;
        }
        
        .favorite-btn:hover .slash-line {
            stroke: #e74c3c;
        }
        
        /* Enhanced Accordion Styling - consistent with menu.html */
        .accordion {
            background-color: #000;
            color: #fff;
            cursor: pointer;
            padding: 18px 18px 18px 50px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1.8rem;
            font-weight: 800;
            transition: all 0.3s;
            position: relative;
            margin-bottom: 15px;
        }
        
        /* Chevron icon for accordion */
        .accordion::before {
            content: '';
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 10px solid #fff;
            transition: transform 0.3s ease;
        }
        
        .accordion.active::before {
            transform: translateY(-50%) rotate(180deg);
        }
        
        .accordion:hover,
        .accordion.active {
            background-color: #884b05;
            border-bottom: dashed 5px;
        }
        
        /* Focus state for keyboard accessibility */
        .accordion:focus-visible {
            outline: 3px solid #ffffff;
            outline-offset: -3px;
        }
        
        .accordion h2 {
            color: #fff;
            margin: 0;
            display: inline;
            font-size: inherit;
            font-weight: inherit;
            text-transform: capitalize;
        }
        
        .panel {
            padding: 20px 18px;
            display: none;
            background-color: white;
            overflow: visible;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .restaurant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .restaurant-card h3 {
            margin: 0 0 0.5rem 0;
            font-weight: 800;
            color: #000;
        }
        
        .restaurant-card h3 a {
            color: inherit;
            text-decoration: underline;
        }
        
        .restaurant-card h3 a:hover,
        .restaurant-card h3 a:focus {
            color: #884b05;
            text-decoration: none;
        }
        
        .restaurant-category {
            font-weight: 700;
            color: #884b05;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .restaurant-price {
            color: #333;
            margin: 0 0 0.75rem 0;
        }
        
        .restaurant-address {
            color: #555;
            margin: 0 0 0.75rem 0;
        }
        
        .restaurant-card .distance {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 1.35rem;
            font-weight: 600;
            color: #000;
        }
        
        .location-detected {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            font-weight: 600;
            color: #2e7d32;
        }
        
        .location-detected svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }
        
        /* ============================================ */
        /* SNAP ALERT CUSTOM STYLING */
        /* ============================================ */
        
        @keyframes snapPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .snap-alert {
            padding: 2rem;
            background: #ffffff;
            border-radius: 12px;
            text-align: center;
            animation: snapPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 8px 24px rgba(136, 75, 5, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .snap-alert-heading {
            color: #000;
            margin-bottom: 1rem;
            font-size: 25px;
            word-wrap:normal;
            font-weight: 900;
            font-family: "Work Sans", sans-serif;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .snap-alert-text {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
            color: #000;
        }
        
        .snap-alert-distance {
            font-size: 1rem;
            color: #555;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        
        .snap-logo {
            width: 150px;
            height: 150px;
            display: block;
            margin: 0 auto 1rem;
            animation: snapLogoReveal 0.6s ease-out;
            position: relative;
            z-index: 1;
        }
        
        @keyframes snapLogoReveal {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            60% {
                transform: scale(1.1) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        /* ============================================ */
        /* CRITICAL MOBILE NAV OVERRIDES - MUST BE LAST */
        /* These override styles.css mobile nav rules */
        /* ============================================ */
        
        @media (max-width: 767px) {
            /* Force old navigation to NEVER show on mobile */
            .main-nav {
                display: none !important;
            }
            
            .main-nav.active {
                display: none !important;
            }
            
            /* Ensure hamburger button is visible and clickable */
            .menu-toggle {
                display: block !important;
                position: relative !important;
                z-index: 10 !important;
            }
            
            /* Ensure new mobile nav container works */
            .mobile-nav-container[data-visible="true"] {
                display: block !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                z-index: 2000 !important;
            }
        }
    </style>
</head>
<body>
    <!-- Hidden Audio Element for Snap Sound -->
    <audio id="snapSound" preload="auto">
        <source src="/horror_bone_break_fingers.mp3" type="audio/mpeg">
    </audio>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- SITE HEADER -->
    <!-- HEADER loads from header.html -->
    <div id="header-placeholder"></div>

    </div>

    <!-- HERO BANNER -->
    <section class="hero-banner" aria-label="Welcome banner">
        <img src="Site_a11yBanner.png" alt="Menus 4 ALL logo with a lady with a delightful huge smile looking at her phone with a friend equally delighted looking at her" class="hero-banner-image">
        <div class="hero-overlay">
        </div>
    </section>

    <!-- CTA BUTTONS -->
    <div class="cta-buttons">
        <button class="cta-btn" onclick="scrollToSection('nearby-section'); findNearbyRestaurants();">Menus Nearby</button>
        <button class="cta-btn" onclick="scrollToSection('search-accordion'); setTimeout(() => { document.getElementById('search-accordion').click(); setTimeout(() => document.getElementById('searchInput').focus(), 300); }, 500);">Search</button>
        <button class="cta-btn" onclick="scrollToSection('all-menus-accordion'); setTimeout(() => document.getElementById('all-menus-accordion').click(), 500);">All Menus</button>
    </div>

    <!-- MAIN CONTENT -->
    <main id="main-content" class="container">


      <!-- Location Section -->
        <section class="location-section" id="nearby-section" aria-labelledby="nearby-heading">
            <p >Menus4ALL is a free service providing truly accessible restaurant menus that work on Apple and Android phones, tablets, and computers. Every menu built to support screen readers, digital braille, and ultra-large text for low vision. Search for a menu ... and if you don't see the restaurant you want, submit a request. It's all free. Enjoy.</p><br>
            <h2 class="section-heading" id="nearby-heading" style="color: var(--primary-brown); margin-left: 10px; display: inline-block; margin-right: 1rem;">Looking for a menu nearby?</h2>
            <button class="btn btn-primary" onclick="findNearbyRestaurants()" aria-label="Find restaurants near my location" style="display: inline-block; vertical-align: middle;">Accessible Menus Nearby Search</button>
            <div id="nearbyRestaurants" style="display: none; margin-top: 1rem;" aria-live="polite"></div>
        </section>

 <!-- accordion 1  -->
<button class="accordion" id="search-accordion" aria-expanded="false" aria-controls="search-panel"> 
    <h2 class="section-heading" id="search-heading">Search by Name, City, or Zip Code</h2>
</button>
<div class="panel" id="search-panel" role="region" aria-labelledby="search-heading">
       <!-- Search Section -->
        <section class="search-section" id="search" aria-labelledby="search-heading">
            <div class="search-box">
                <div style="flex: 1;">
                    <label for="searchInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #000;">Enter restaurant name, city, or zip code</label>
                    <div class="voice-input-wrapper">
                        <input 
                            type="text" 
                            id="searchInput" 
                            aria-label="Search restaurants by name, city, or zip code"
                            onkeyup="handleSearchKeyup(event)"
                        >
                        </div>
                    </div>
                <button class="btn btn-primary" onclick="searchMenus()" style="align-self: flex-end;">Search</button>
            </div>
            <div id="searchResults" aria-live="polite"></div>
        </section>
</div>
        
        <br> <br>
 <!-- accordion 2  -->
        
<button class="accordion" id="all-menus-accordion" aria-expanded="false" aria-controls="all-menus-panel">
    <h2 class="section-heading" id="all-heading">All Accessible Restaurant Menus</h2>
</button>
<div class="panel" id="all-menus-panel" role="region" aria-labelledby="all-heading">
      <!-- All Restaurants Section -->
        <section id="allRestaurants" aria-labelledby="all-heading">
          
            <div id="restaurantsList" aria-live="polite">
                <p class="loading">Loading restaurants</p>
            </div>
        </section>
</div>       


    </main>

    <!-- SITE FOOTER -->

    <!-- FOOTER loads from footer.html -->
    <div id="footer-placeholder"></div>

    <!-- Global components loader (loads header/footer and handles navigation) -->
    <script src="global-components.js"></script>

    <!-- YOUR FIREBASE AND RESTAURANT JAVASCRIPT -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBSi2_gNfiRo4zKeyLjOA9dIk05v8e_Tsg",
            authDomain: "menus4allbeta-default-rtdb.firebaseapp.com",
            databaseURL: "https://menus4allbeta-default-rtdb.firebaseio.com",
            projectId: "menus4allbeta",
            storageBucket: "menus4allbeta.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let allRestaurants = [];
        let userLocation = null;

        // Load restaurant data from Firebase with DUAL-PATH support
        async function loadRestaurants() {
            try {
                console.log('ðŸ” Starting restaurant load with dual-path support...');
                
                // FIRST: Try to load from production/menus path (new structure)
                const newStructureRef = database.ref('/production/menus');
                const newSnapshot = await newStructureRef.once('value');
                const newData = newSnapshot.val();
                
                console.log('ðŸ“ New structure data:', newData ? 'Found' : 'Not found');
                
                // SECOND: Try to load from root (old/current structure)
                const oldStructureRef = database.ref('/');
                const oldSnapshot = await oldStructureRef.once('value');
                const oldData = oldSnapshot.val();
                
                console.log('ðŸ“ Old structure data:', oldData ? 'Found' : 'Not found');
                
                // Combine both sources
                let combinedRestaurants = [];
                
                // Process NEW structure (country/state/city/restaurant)
                if (newData && typeof newData === 'object') {
                    console.log('ðŸŒ Processing new structure...');
                    
                    Object.keys(newData).forEach(country => {
                        if (country.startsWith('_')) return; // Skip metadata
                        
                        const countryData = newData[country];
                        if (typeof countryData !== 'object') return;
                        
                        Object.keys(countryData).forEach(state => {
                            if (state.startsWith('_')) return;
                            
                            const stateData = countryData[state];
                            if (typeof stateData !== 'object') return;
                            
                            Object.keys(stateData).forEach(city => {
                                if (city.startsWith('_')) return;
                                
                                const cityData = stateData[city];
                                if (typeof cityData !== 'object') return;
                                
                                Object.keys(cityData).forEach(restaurantSlug => {
                                    if (restaurantSlug.startsWith('_')) return;
                                    
                                    const restaurant = cityData[restaurantSlug];
                                    
                                    // Helper function to safely parse coordinates
                                    const parseCoord = (value) => {
                                        if (value === '' || value === null || value === undefined) return 0;
                                        const parsed = parseFloat(value);
                                        return isNaN(parsed) ? 0 : parsed;
                                    };
                                    
                                    let lat = parseCoord(restaurant.restaurantInfo?.lat) || parseCoord(restaurant.lat);
                                    let lng = parseCoord(restaurant.restaurantInfo?.lng) || parseCoord(restaurant.lng);
                                    
                                    // Fix swapped coordinates
                                    if (lat < -50 && lng > 0 && lng < 60) {
                                        console.warn(`âš ï¸ Swapped coordinates for ${restaurant.restaurantInfo?.name || restaurantSlug}`);
                                        const temp = lat;
                                        lat = lng;
                                        lng = temp;
                                    }
                                    
                                    combinedRestaurants.push({
                                        id: restaurantSlug,
                                        name: restaurant.restaurantInfo?.name || restaurant.name || 'Unknown Restaurant',
                                        category: restaurant.restaurantInfo?.cuisineType || restaurant.restaurantInfo?.category || restaurant.category || '',
                                        dietary: restaurant.restaurantInfo?.dietary || [],
                                        address: restaurant.restaurantInfo?.address || restaurant.address || '',
                                        city: restaurant.restaurantInfo?.city || restaurant.city || city,
                                        state: restaurant.restaurantInfo?.state || restaurant.state || state,
                                        country: country,
                                        phone: restaurant.restaurantInfo?.phone || restaurant.phone || '',
                                        averageMealPrice: restaurant.restaurantInfo?.averageMealPrice || '',
                                        heroImage: restaurant.restaurantInfo?.heroImage || '',
                                        heroImageAlt: restaurant.restaurantInfo?.heroImageAlt || '',
                                        lat: lat,
                                        lng: lng,
                                        hasCoordinates: lat !== 0 && lng !== 0 && !isNaN(lat) && !isNaN(lng),
                                        source: 'new-structure',
                                        path: `${country}/${state}/${city}/${restaurantSlug}`
                                    });
                                    
                                    console.log(`âœ… Loaded from NEW: ${restaurant.restaurantInfo?.name || restaurantSlug} (${country}/${state}/${city})`);
                                });
                            });
                        });
                    });
                }
                
                // Process OLD structure (flat restaurant IDs)
                if (oldData && typeof oldData === 'object') {
                    console.log('ðŸ“‚ Processing old structure...');
                    
                    Object.keys(oldData).forEach(key => {
                        if (key.startsWith('_') || key === 'production' || key === 'staging') return; // Skip metadata and new structure paths
                        
                        const restaurant = oldData[key];
                        if (!restaurant || typeof restaurant !== 'object') return;
                        
                        // Check if this restaurant already exists in new structure
                        const alreadyExists = combinedRestaurants.some(r => r.id === key);
                        if (alreadyExists) {
                            console.log(`â­ï¸  Skipping duplicate: ${restaurant.restaurantInfo?.name || key} (already in new structure)`);
                            return;
                        }
                        
                        const parseCoord = (value) => {
                            if (value === '' || value === null || value === undefined) return 0;
                            const parsed = parseFloat(value);
                            return isNaN(parsed) ? 0 : parsed;
                        };
                        
                        let lat = parseCoord(restaurant.restaurantInfo?.lat) || parseCoord(restaurant.lat);
                        let lng = parseCoord(restaurant.restaurantInfo?.lng) || parseCoord(restaurant.lng);
                        
                        if (lat < -50 && lng > 0 && lng < 60) {
                            const temp = lat;
                            lat = lng;
                            lng = temp;
                        }
                        
                        combinedRestaurants.push({
                            id: key,
                            name: restaurant.restaurantInfo?.name || restaurant.name || 'Unknown Restaurant',
                            category: restaurant.restaurantInfo?.cuisineType || restaurant.restaurantInfo?.category || restaurant.category || '',
                            dietary: restaurant.restaurantInfo?.dietary || [],
                            address: restaurant.restaurantInfo?.address || restaurant.address || '',
                            city: restaurant.restaurantInfo?.city || restaurant.city || '',
                            state: restaurant.restaurantInfo?.state || restaurant.state || '',
                            country: 'usa', // Default for old structure
                            phone: restaurant.restaurantInfo?.phone || restaurant.phone || '',
                            averageMealPrice: restaurant.restaurantInfo?.averageMealPrice || '',
                            heroImage: restaurant.restaurantInfo?.heroImage || '',
                            heroImageAlt: restaurant.restaurantInfo?.heroImageAlt || '',
                            lat: lat,
                            lng: lng,
                            hasCoordinates: lat !== 0 && lng !== 0 && !isNaN(lat) && !isNaN(lng),
                            source: 'old-structure',
                            path: key
                        });
                        
                        console.log(`âœ… Loaded from OLD: ${restaurant.restaurantInfo?.name || key}`);
                    });
                }
                
                if (combinedRestaurants.length === 0) {
                    console.log('âŒ No restaurant data found in either structure');
                    document.getElementById('restaurantsList').innerHTML = '<p>No restaurants available yet.</p>';
                    return;
                }
                
                allRestaurants = combinedRestaurants.filter(r => r.name && r.address);
                
                console.log('âœ… Total restaurants loaded:', allRestaurants.length);
                console.log('ðŸ“Š From new structure:', allRestaurants.filter(r => r.source === 'new-structure').length);
                console.log('ðŸ“Š From old structure:', allRestaurants.filter(r => r.source === 'old-structure').length);
                console.log('ðŸ“ With coordinates:', allRestaurants.filter(r => r.hasCoordinates).length);
                
                displayAllRestaurants();
            } catch (error) {
                console.error('ðŸš¨ Error loading restaurants:', error);
                console.error('Error details:', error.message, error.stack);
                document.getElementById('restaurantsList').innerHTML = '<p>Error loading restaurants. Please try again later.</p>';
            }
        }

        function findNearbyRestaurants() {
            const nearbyDiv = document.getElementById('nearbyRestaurants');
            nearbyDiv.innerHTML = '<p class="loading">Getting your location</p>';
            nearbyDiv.style.display = 'block';

            if (!navigator.geolocation) {
                nearbyDiv.innerHTML = '<p>Geolocation is not supported by your browser.</p>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                position => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    displayNearbyRestaurants();
                },
                error => {
                    let errorMessage = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '<p><strong>Location access blocked.</strong> To use this feature, please enable location permissions for this site in your browser settings.</p><p>Meanwhile, you can search by city or zip code below.</p>';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '<p><strong>Location unavailable.</strong> Your device location could not be determined.</p><p>Please search by city or zip code below.</p>';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '<p><strong>Location request timed out.</strong> Please try again or search by city or zip code below.</p>';
                            break;
                        default:
                            errorMessage = '<p><strong>Unable to retrieve your location.</strong> Please search by city or zip code below.</p>';
                    }
                    nearbyDiv.innerHTML = errorMessage;
                }
            );
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 3959;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Store nearby restaurants globally for "Load More" functionality
        let allNearbyRestaurants = [];
        
        function displayNearbyRestaurants() {
            const nearbyDiv = document.getElementById('nearbyRestaurants');
            
            if (!userLocation) {
                nearbyDiv.innerHTML = '<p>Location not available.</p>';
                return;
            }

            console.log('User location:', userLocation);
            console.log('Total restaurants:', allRestaurants.length);
            
            // Only include restaurants that have valid coordinates
            const restaurantsWithCoords = allRestaurants.filter(r => r.hasCoordinates);
            console.log('Restaurants with coordinates:', restaurantsWithCoords.length);

            const restaurantsWithDistance = restaurantsWithCoords.map(restaurant => ({
                ...restaurant,
                distance: calculateDistance(
                    userLocation.lat,
                    userLocation.lng,
                    restaurant.lat,
                    restaurant.lng
                )
            }))
            .filter(restaurant => restaurant.distance <= 10) // Only show restaurants within 10 miles
            .sort((a, b) => a.distance - b.distance);

            console.log('Restaurants within 10 miles:', restaurantsWithDistance);
            
            // Store all nearby restaurants for Load More functionality
            allNearbyRestaurants = restaurantsWithDistance;

            // AUTO-LOAD MENU: If user is within 0.02 miles (~100 feet) of a restaurant, automatically load that menu
            // This provides an equal experience to sighted diners who immediately see the menu when they arrive
            // Distance is kept tight (100 feet) to work accurately in dense urban areas like NYC
            // Users can disable this by setting localStorage item 'disableAutoLoad' to 'true'
            const autoLoadEnabled = localStorage.getItem('disableAutoLoad') !== 'true';
            
            if (autoLoadEnabled && restaurantsWithDistance.length > 0 && restaurantsWithDistance[0].distance <= 0.02) {
                const closestRestaurant = restaurantsWithDistance[0];
                const stateSlug = closestRestaurant.state.toLowerCase().replace(/\s+/g, '-');
                const citySlug = closestRestaurant.city.toLowerCase().replace(/\s+/g, '-');
                const menuUrl = `/${stateSlug}/${citySlug}/${closestRestaurant.id}`;
                
                console.log(`ðŸŽ¯ AUTO-LOADING MENU: You are at ${closestRestaurant.name} (${(closestRestaurant.distance * 5280).toFixed(0)} feet away)`);
                console.log(`Redirecting to: ${menuUrl}`);
                
                // PLAY SNAP SOUND!
                playSnapSound();
                
                // Create styled alert with animation
                nearbyDiv.innerHTML = `
                    <div class="snap-alert" role="alert" aria-live="assertive">
                        <img src="apple-touch-icon.png" alt="Menus4ALL logo" class="snap-logo">
                        <h3 class="snap-alert-heading">
                            Loading ${closestRestaurant.name}'s accessible menu...
                        </h3>
                        <p class="snap-alert-distance">
                            You're just ${(closestRestaurant.distance * 5280).toFixed(0)} feet away
                        </p>
                    </div>
                `;
                
                // Redirect to the menu after allowing time for announcement
                setTimeout(() => {
                    window.location.href = menuUrl;
                }, 1500);
                
                return; // Exit function - we're redirecting
            }

            // Show first 4 restaurants initially
            const initialRestaurants = restaurantsWithDistance.slice(0, 4);

            if (initialRestaurants.length === 0) {
                const restaurantsWithoutCoords = allRestaurants.filter(r => !r.hasCoordinates);
                nearbyDiv.innerHTML = `
                    <div class="no-results">
                        <h3 style="color: var(--primary-brown);">No restaurants found within 10 miles - but we've got you covered!</h3>
                        <p style="margin-top: 1rem;"><strong>Planning a trip or looking for a specific restaurant? Here are two easy options:</strong></p>
                        <ol style="margin: 1rem 0 1rem 2rem; line-height: 1.8;">
                            <li><strong>Search below</strong> by restaurant name, city, or zip code</li>
                            <li><strong>Request a menu conversion</strong> - just ask us!</li>
                        </ol>
                        <p style="margin-top: 1rem;"><em>Remember: Converting menus is always free, and our service is always free to use.</em></p>
                        ${restaurantsWithoutCoords.length > 0 ? `<p style="margin-top: 1rem; font-size: 0.9rem; color: #666;"><strong>Note:</strong> ${restaurantsWithoutCoords.length} restaurant${restaurantsWithoutCoords.length !== 1 ? 's' : ''} in our database ${restaurantsWithoutCoords.length !== 1 ? 'are' : 'is'} missing location coordinates and can't be shown in nearby results. You can still find ${restaurantsWithoutCoords.length !== 1 ? 'them' : 'it'} using the search below!</p>` : ''}
                    </div>
                `;
                return;
            }

            const heading = document.createElement('h3');
            heading.className = 'section-heading';
            // Show count info: "4 of 12 Restaurants Within 10 Miles" or just "4 Restaurants Within 10 Miles" if 4 or fewer
            const totalCount = restaurantsWithDistance.length;
            if (totalCount > 4) {
                heading.textContent = `${initialRestaurants.length} of ${totalCount} Restaurants Within 10 Miles`;
            } else {
                heading.textContent = `${totalCount} Restaurant${totalCount !== 1 ? 's' : ''} Within 10 Miles`;
            }

            const list = document.createElement('ul');
            list.className = 'restaurant-list';
            list.setAttribute('role', 'list');
            list.id = 'nearbyRestaurantsList';

            initialRestaurants.forEach((restaurant, index) => {
                const stateSlug = restaurant.state.toLowerCase().replace(/\s+/g, '-');
                const citySlug = restaurant.city.toLowerCase().replace(/\s+/g, '-');
                const url = `/${stateSlug}/${citySlug}/${restaurant.id}`;
                
                const listItem = createRestaurantCard(restaurant, index + 1, url);
                list.appendChild(listItem);
            });

            nearbyDiv.innerHTML = '';
            nearbyDiv.appendChild(heading);
            nearbyDiv.appendChild(list);
            
            // Add "Load More" button if there are more restaurants to show
            if (restaurantsWithDistance.length > 4) {
                const remainingCount = restaurantsWithDistance.length - 4;
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.id = 'loadMoreNearbyBtn';
                loadMoreBtn.className = 'load-more-btn';
                loadMoreBtn.setAttribute('type', 'button');
                loadMoreBtn.setAttribute('aria-label', `Load ${remainingCount} more nearby restaurants`);
                loadMoreBtn.innerHTML = `
                    <span>Load ${remainingCount} More Restaurant${remainingCount !== 1 ? 's' : ''}</span>
                    <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                `;
                loadMoreBtn.onclick = loadMoreNearbyRestaurants;
                nearbyDiv.appendChild(loadMoreBtn);
            }
            
            nearbyDiv.style.display = 'block';
        }
        
        function loadMoreNearbyRestaurants() {
            const list = document.getElementById('nearbyRestaurantsList');
            const loadMoreBtn = document.getElementById('loadMoreNearbyBtn');
            const heading = document.querySelector('#nearbyRestaurants .section-heading');
            
            if (!list || !allNearbyRestaurants.length) return;
            
            // Get restaurants beyond the first 4
            const remainingRestaurants = allNearbyRestaurants.slice(4);
            
            // Track the first new item for focus management
            let firstNewItem = null;
            
            remainingRestaurants.forEach((restaurant, index) => {
                const stateSlug = restaurant.state.toLowerCase().replace(/\s+/g, '-');
                const citySlug = restaurant.city.toLowerCase().replace(/\s+/g, '-');
                const url = `/${stateSlug}/${citySlug}/${restaurant.id}`;
                
                // Index continues from where we left off (4 + index gives 5, 6, 7...)
                const listItem = createRestaurantCard(restaurant, 5 + index, url);
                list.appendChild(listItem);
                
                // Store reference to first new item
                if (index === 0) {
                    firstNewItem = listItem;
                }
            });
            
            // Update heading to show all restaurants
            if (heading) {
                const totalCount = allNearbyRestaurants.length;
                heading.textContent = `${totalCount} Restaurant${totalCount !== 1 ? 's' : ''} Within 10 Miles`;
            }
            
            // Remove the Load More button
            if (loadMoreBtn) {
                loadMoreBtn.remove();
            }
            
            // Announce to screen readers
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.className = 'sr-only';
            announcement.textContent = `Loaded ${remainingRestaurants.length} more restaurants. Now showing all ${allNearbyRestaurants.length} restaurants within 10 miles.`;
            document.body.appendChild(announcement);
            
            // Remove announcement after it's been read
            setTimeout(() => announcement.remove(), 3000);
            
            // Scroll to and focus the first new restaurant card
            if (firstNewItem) {
                firstNewItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Focus the link inside the first new card for keyboard users
                const firstLink = firstNewItem.querySelector('a');
                if (firstLink) {
                    setTimeout(() => firstLink.focus(), 500);
                }
            }
        }

        function createRestaurantCard(restaurant, number, url) {
            const li = document.createElement('li');
            li.className = 'restaurant-card';

            // Hero image section - always create, with fallback if no image
            const imageDiv = document.createElement('div');
            imageDiv.className = 'restaurant-card-image';
            
            if (restaurant.heroImage && restaurant.heroImage.trim() !== '') {
                // Use picture element for better browser support
                const picture = document.createElement('picture');
                
                // AVIF source (for Chrome, Edge, Firefox)
                const avifSource = document.createElement('source');
                avifSource.srcset = restaurant.heroImage;
                avifSource.type = 'image/avif';
                picture.appendChild(avifSource);
                
                // WebP fallback (for Safari and others)
                const webpSource = document.createElement('source');
                webpSource.srcset = restaurant.heroImage.replace('.avif', '.webp');
                webpSource.type = 'image/webp';
                picture.appendChild(webpSource);
                
                // Final fallback image (will show if both fail)
                const img = document.createElement('img');
                img.src = restaurant.heroImage.replace('.avif', '.webp');
                img.alt = restaurant.heroImageAlt || `${restaurant.name} restaurant image`;
                img.loading = 'lazy';
                
                // Debug logging
                console.log(`Loading image for ${restaurant.name}: ${restaurant.heroImage}`);
                
                img.onload = function() {
                    console.log(`âœ… Successfully loaded: ${restaurant.heroImage}`);
                };
                
                // Add error handler for failed image loads
                img.onerror = function() {
                    console.error(`âŒ Failed to load: ${restaurant.heroImage}`);
                    this.style.display = 'none';
                    const imageDiv = this.closest('.restaurant-card-image');
                    if (imageDiv) {
                        imageDiv.style.background = '#e0e0e0';
                        const nameOverlay = document.createElement('div');
                        nameOverlay.style.cssText = 'display: flex; align-items: center; justify-content: center; height: 100%; padding: 2rem; text-align: center; font-size: 1.5rem; color: #666; font-weight: 600;';
                        nameOverlay.textContent = restaurant.name;
                        imageDiv.appendChild(nameOverlay);
                    }
                };
                
                picture.appendChild(img);
                imageDiv.appendChild(picture);
            } else {
                // No image URL - show restaurant name on gray background
                imageDiv.style.background = '#e0e0e0';
                
                const nameOverlay = document.createElement('div');
                nameOverlay.style.cssText = 'display: flex; align-items: center; justify-content: center; height: 100%; padding: 2rem; text-align: center; font-size: 1.5rem; color: #666; font-weight: 600;';
                nameOverlay.textContent = restaurant.name;
                imageDiv.appendChild(nameOverlay);
            }
            
            li.appendChild(imageDiv);

            // Content wrapper
            const contentDiv = document.createElement('div');
            contentDiv.className = 'restaurant-card-content';

            // 1. Title with number
            const h3 = document.createElement('h3');
            const a = document.createElement('a');
            a.href = url;
            a.textContent = `${number ? number + '. ' : ''}${addPossessive(restaurant.name)}`;
            h3.appendChild(a);
            contentDiv.appendChild(h3);

            // 2. Category with dietary badges (if available)
            if (restaurant.category || (restaurant.dietary && restaurant.dietary.length > 0)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'restaurant-category';
                
                let categoryText = restaurant.category ? restaurant.category.toUpperCase() : '';
                
                // Add dietary badges
                if (restaurant.dietary && restaurant.dietary.length > 0) {
                    const badges = restaurant.dietary.map((d, index) => {
                        const dietClass = d.toLowerCase().replace(/\s+/g, '-');
                        const badgeId = `badge-${dietClass}-${Date.now()}-${index}`;
                        return `<span class="dietary-badge ${dietClass}" aria-describedby="${badgeId}">${d}<span id="${badgeId}" class="sr-only"> options</span></span>`;
                    }).join(' ');
                    categoryDiv.innerHTML = categoryText + (categoryText ? ' ' : '') + badges;
                } else {
                    categoryDiv.textContent = categoryText;
                }
                
                contentDiv.appendChild(categoryDiv);
            }

            // 3. Average price (remove extra $ if present)
            if (restaurant.averageMealPrice) {
                const priceP = document.createElement('p');
                priceP.className = 'restaurant-price';
                const price = restaurant.averageMealPrice.replace(/^\$+/, '$'); // Remove duplicate $
                priceP.textContent = `${price} per person on average`;
                contentDiv.appendChild(priceP);
            }

            // 4. Address
            const addressP = document.createElement('p');
            addressP.className = 'restaurant-address';
            addressP.textContent = restaurant.address;
            contentDiv.appendChild(addressP);

            // 5. Distance (if available)
            if (restaurant.distance !== undefined) {
                const distanceSpan = document.createElement('span');
                distanceSpan.className = 'distance';
                distanceSpan.textContent = `${restaurant.distance.toFixed(1)} miles away`;
                contentDiv.appendChild(distanceSpan);
            }

            li.appendChild(contentDiv);
            
            // Favorite button - add as direct child of li, not inside contentDiv
            const favoriteBtn = document.createElement('button');
            favoriteBtn.className = 'favorite-btn';
            favoriteBtn.setAttribute('type', 'button');
            favoriteBtn.setAttribute('aria-label', `Add ${restaurant.name} to favorites`);
            favoriteBtn.setAttribute('title', 'Add to favorites');
            favoriteBtn.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                toggleFavorite(restaurant.id, favoriteBtn, restaurant.name);
            };
            
            // Check if already favorited
            if (isFavorite(restaurant.id)) {
                favoriteBtn.classList.add('is-favorite');
                favoriteBtn.setAttribute('aria-label', `Remove ${restaurant.name} from favorites`);
                favoriteBtn.setAttribute('title', 'Remove from favorites');
            }
            
            favoriteBtn.innerHTML = `
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    <line class="slash-line" x1="4" y1="20" x2="20" y2="4" />
                </svg>
                <span class="sr-only">${isFavorite(restaurant.id) ? 'Remove from favorites' : 'Add to favorites'}</span>
            `;
            li.appendChild(favoriteBtn);
            
            return li;
        }

        function createInfoDiv(svgPath, text) {
            const div = document.createElement('div');
            div.className = 'restaurant-info';

            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('fill', 'currentColor');
            svg.setAttribute('viewBox', '0 0 20 20');
            svg.setAttribute('aria-hidden', 'true');
            svg.setAttribute('focusable', 'false');

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', svgPath);
            if (svgPath.includes('fill-rule')) {
                path.setAttribute('fill-rule', 'evenodd');
                path.setAttribute('clip-rule', 'evenodd');
            }
            svg.appendChild(path);

            const span = document.createElement('span');
            span.innerHTML = text;

            div.appendChild(svg);
            div.appendChild(span);

            return div;
        }

        // ===== FAVORITES FUNCTIONALITY =====
        // Favorites functions now loaded from /favorites-system.js
        
        function toggleFavorite(restaurantId, button, restaurantName) {
            let favorites = getFavorites();
            const index = favorites.indexOf(restaurantId);
            
            if (index > -1) {
                // Remove from favorites
                favorites.splice(index, 1);
                button.classList.remove('is-favorite');
                button.setAttribute('aria-label', `Add ${restaurantName} to favorites`);
                button.setAttribute('title', 'Add to favorites');
                // Update sr-only text
                const srOnly = button.querySelector('.sr-only');
                if (srOnly) srOnly.textContent = 'Add to favorites';
                
                // Announce to screen reader
                announceToScreenReader(`${restaurantName} removed from your favorites`);
            } else {
                // Add to favorites
                favorites.push(restaurantId);
                button.classList.add('is-favorite');
                button.setAttribute('aria-label', `Remove ${restaurantName} from favorites`);
                button.setAttribute('title', 'Remove from favorites');
                // Update sr-only text
                const srOnly = button.querySelector('.sr-only');
                if (srOnly) srOnly.textContent = 'Remove from favorites';
                
                // Announce to screen reader
                announceToScreenReader(`${restaurantName} added to your favorites`);
            }
            
            saveFavorites(favorites);
            button.blur();
        }

        function displayAllRestaurants() {
            const listDiv = document.getElementById('restaurantsList');
            
            if (allRestaurants.length === 0) {
                listDiv.innerHTML = '<p>No restaurants available yet.</p>';
                return;
            }

            const byState = {};
            allRestaurants.forEach(restaurant => {
                const state = restaurant.state || 'Texas';
                if (!byState[state]) byState[state] = {};
                
                const city = restaurant.city || 'Austin';
                if (!byState[state][city]) byState[state][city] = [];
                
                byState[state][city].push(restaurant);
            });

            listDiv.innerHTML = '';

            Object.entries(byState).sort().forEach(([state, cities]) => {
                const stateGroup = document.createElement('div');
                stateGroup.className = 'state-group';

                const stateHeading = document.createElement('h3');
                stateHeading.className = 'state-heading';
                stateHeading.textContent = state;
                stateGroup.appendChild(stateHeading);
                
                Object.entries(cities).sort().forEach(([city, restaurants]) => {
                    const citySection = document.createElement('div');
                    citySection.className = 'city-section';

                    const cityHeading = document.createElement('h4');
                    cityHeading.className = 'city-heading';
                    cityHeading.textContent = city;
                    citySection.appendChild(cityHeading);

                    const list = document.createElement('ul');
                    list.className = 'restaurant-list';
                    list.setAttribute('role', 'list');
                    
                    restaurants.sort((a, b) => a.name.localeCompare(b.name)).forEach(restaurant => {
                        const stateSlug = state.toLowerCase().replace(/\s+/g, '-');
                        const citySlug = city.toLowerCase().replace(/\s+/g, '-');
                        const url = `/${stateSlug}/${citySlug}/${restaurant.id}`;
                        
                        const listItem = createRestaurantCard(restaurant, null, url);
                        list.appendChild(listItem);
                    });
                    
                    citySection.appendChild(list);
                    stateGroup.appendChild(citySection);
                });
                
                listDiv.appendChild(stateGroup);
            });
        }

        function showAllRestaurants() {
            document.getElementById('allRestaurants').scrollIntoView({ behavior: 'smooth' });
        }

        function searchMenus() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query) {
                resultsDiv.innerHTML = '';
                return;
            }

            const results = allRestaurants.filter(restaurant => {
                // Extract all zip codes from address (5-digit or ZIP+4 format)
                const zipMatch = restaurant.address.match(/\b\d{5}(?:-\d{4})?\b/);
                const zipCode = zipMatch ? zipMatch[0] : '';
                
                // Also check if the query is numeric and matches part of the zip
                const isNumericQuery = /^\d+$/.test(query);
                const zipPartialMatch = isNumericQuery && zipCode.startsWith(query);
                
                return (
                    restaurant.name.toLowerCase().includes(query) ||
                    restaurant.address.toLowerCase().includes(query) ||
                    restaurant.city.toLowerCase().includes(query) ||
                    restaurant.state.toLowerCase().includes(query) ||
                    zipCode.includes(query) ||
                    zipPartialMatch
                );
            });

            if (results.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'no-results';
                noResults.innerHTML = `<strong>No results found for "${escapeHtml(query)}"</strong><br>Try searching by restaurant name, city, or zip code.`;
                resultsDiv.innerHTML = '';
                resultsDiv.appendChild(noResults);
            } else {
                const heading = document.createElement('h3');
                heading.className = 'section-heading';
                heading.textContent = `${results.length} Result${results.length !== 1 ? 's' : ''} for "${escapeHtml(query)}"`;

                const list = document.createElement('ul');
                list.className = 'restaurant-list';
                list.setAttribute('role', 'list');
                
                results.forEach(restaurant => {
                    const stateSlug = (restaurant.state || 'texas').toLowerCase().replace(/\s+/g, '-');
                    const citySlug = (restaurant.city || 'austin').toLowerCase().replace(/\s+/g, '-');
                    const url = `/${stateSlug}/${citySlug}/${restaurant.id}`;
                    
                    const listItem = createRestaurantCard(restaurant, null, url);
                    list.appendChild(listItem);
                });
                
                resultsDiv.innerHTML = '';
                resultsDiv.appendChild(heading);
                resultsDiv.appendChild(list);
            }

            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function handleSearchKeyup(event) {
            if (event.key === 'Enter') {
                searchMenus();
            }
        }

        function focusSearch() {
            document.getElementById('searchInput').focus();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function scrollToSection(elementId, additionalOffset = 0) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            // Get the height of the sticky header
            const header = document.querySelector('.site-header');
            const headerHeight = header ? header.offsetHeight : 0;
            
            // Calculate position with offset for sticky header plus additional spacing
            const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
            const offsetPosition = elementPosition - headerHeight - 20 - additionalOffset;
            
            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }

        function addPossessive(name) {
            if (!name) return '';
            return name.endsWith('s') ? `${name}' Menu` : `${name}'s Menu`;
        }

        function toggleContrast() {
            document.body.classList.toggle('high-contrast');
            const isHighContrast = document.body.classList.contains('high-contrast');
            localStorage.setItem('highContrast', isHighContrast);
        }

        // ============================================
        // NEW ACCESSIBLE MOBILE NAVIGATION SYSTEM
        // ============================================
        console.log('Navigation script loading...');
        const menuToggle = document.getElementById('menuToggle');
        const closeMenuBtn = document.getElementById('closeMenuBtn');
        const mobileNavContainer = document.getElementById('mobileNavContainer');
        const mobileNav = document.getElementById('mobileNav');
        const sentinelStart = document.querySelector('.focus-sentinel-start');
        const sentinelEnd = document.querySelector('.focus-sentinel-end');
        
        console.log('Elements found:', {
            menuToggle: !!menuToggle,
            closeMenuBtn: !!closeMenuBtn,
            mobileNavContainer: !!mobileNavContainer,
            mobileNav: !!mobileNav
        });
        
        // Focusable elements for focus trap
        let focusableElements = [];
        let firstFocusable = null;
        let lastFocusable = null;
        
        // Store the element that opened the menu
        let menuTrigger = null;
        
        function updateFocusableElements() {
            // Get all focusable elements EXCEPT the sentinels
            focusableElements = Array.from(
                mobileNav.querySelectorAll(
                    'button:not(.focus-sentinel-start):not(.focus-sentinel-end), a, input, select, textarea, [tabindex]:not([tabindex="-1"]):not(.focus-sentinel-start):not(.focus-sentinel-end)'
                )
            ).filter(el => !el.disabled && !el.classList.contains('focus-sentinel-start') && !el.classList.contains('focus-sentinel-end'));
            
            firstFocusable = focusableElements[0];
            lastFocusable = focusableElements[focusableElements.length - 1];
        }
        
        // Handle focus on start sentinel - redirect to last focusable element
        if (sentinelStart) {
            sentinelStart.addEventListener('focus', function() {
                if (mobileNavContainer.getAttribute('data-visible') === 'true' && lastFocusable) {
                    lastFocusable.focus();
                }
            });
        }
        
        // Handle focus on end sentinel - redirect to first focusable element
        if (sentinelEnd) {
            sentinelEnd.addEventListener('focus', function() {
                if (mobileNavContainer.getAttribute('data-visible') === 'true' && firstFocusable) {
                    firstFocusable.focus();
                }
            });
        }
        
        function openMenu() {
            // Store trigger for return focus
            menuTrigger = document.activeElement;
            
            // Update state
            menuToggle.setAttribute('aria-expanded', 'true');
            mobileNavContainer.setAttribute('data-visible', 'true');
            mobileNavContainer.setAttribute('aria-hidden', 'false');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Hide all content outside menu from screen readers
            const mainContent = document.getElementById('main-content');
            const heroSection = document.querySelector('.hero-banner');
            const ctaButtons = document.querySelector('.cta-buttons');
            const footer = document.querySelector('.site-footer');
            const header = document.querySelector('.site-header');
            
            // Store original aria-hidden states
            if (mainContent) {
                mainContent.setAttribute('data-original-hidden', mainContent.getAttribute('aria-hidden') || 'false');
                mainContent.setAttribute('aria-hidden', 'true');
                mainContent.setAttribute('inert', '');
            }
            if (heroSection) {
                heroSection.setAttribute('data-original-hidden', heroSection.getAttribute('aria-hidden') || 'false');
                heroSection.setAttribute('aria-hidden', 'true');
                heroSection.setAttribute('inert', '');
            }
            if (ctaButtons) {
                ctaButtons.setAttribute('data-original-hidden', ctaButtons.getAttribute('aria-hidden') || 'false');
                ctaButtons.setAttribute('aria-hidden', 'true');
                ctaButtons.setAttribute('inert', '');
            }
            if (footer) {
                footer.setAttribute('data-original-hidden', footer.getAttribute('aria-hidden') || 'false');
                footer.setAttribute('aria-hidden', 'true');
                footer.setAttribute('inert', '');
            }
            if (header) {
                header.setAttribute('data-original-hidden', header.getAttribute('aria-hidden') || 'false');
                header.setAttribute('aria-hidden', 'true');
                header.setAttribute('inert', '');
            }
            
            // Update focusable elements
            updateFocusableElements();
            
            // Move focus to FIRST focusable element (close X button)
            setTimeout(() => {
                if (firstFocusable) {
                    firstFocusable.focus();
                }
            }, 100);
            
            // Announce to screen readers
            announceToScreenReader('Navigation menu opened. Swipe to navigate menu items. Double-tap close button or press Escape to close.');
        }
        
        function closeMenu() {
            // Update state
            menuToggle.setAttribute('aria-expanded', 'false');
            mobileNavContainer.setAttribute('data-visible', 'false');
            mobileNavContainer.setAttribute('aria-hidden', 'true');
            
            // Restore body scroll
            document.body.style.overflow = '';
            
            // Restore aria-hidden on background content
            const mainContent = document.getElementById('main-content');
            const heroSection = document.querySelector('.hero-banner');
            const ctaButtons = document.querySelector('.cta-buttons');
            const footer = document.querySelector('.site-footer');
            const header = document.querySelector('.site-header');
            
            if (mainContent) {
                const originalHidden = mainContent.getAttribute('data-original-hidden');
                if (originalHidden === 'false') {
                    mainContent.removeAttribute('aria-hidden');
                } else {
                    mainContent.setAttribute('aria-hidden', originalHidden);
                }
                mainContent.removeAttribute('data-original-hidden');
                mainContent.removeAttribute('inert');
            }
            if (heroSection) {
                const originalHidden = heroSection.getAttribute('data-original-hidden');
                if (originalHidden === 'false') {
                    heroSection.removeAttribute('aria-hidden');
                } else {
                    heroSection.setAttribute('aria-hidden', originalHidden);
                }
                heroSection.removeAttribute('data-original-hidden');
                heroSection.removeAttribute('inert');
            }
            if (ctaButtons) {
                const originalHidden = ctaButtons.getAttribute('data-original-hidden');
                if (originalHidden === 'false') {
                    ctaButtons.removeAttribute('aria-hidden');
                } else {
                    ctaButtons.setAttribute('aria-hidden', originalHidden);
                }
                ctaButtons.removeAttribute('data-original-hidden');
                ctaButtons.removeAttribute('inert');
            }
            if (footer) {
                const originalHidden = footer.getAttribute('data-original-hidden');
                if (originalHidden === 'false') {
                    footer.removeAttribute('aria-hidden');
                } else {
                    footer.setAttribute('aria-hidden', originalHidden);
                }
                footer.removeAttribute('data-original-hidden');
                footer.removeAttribute('inert');
            }
            if (header) {
                const originalHidden = header.getAttribute('data-original-hidden');
                if (originalHidden === 'false') {
                    header.removeAttribute('aria-hidden');
                } else {
                    header.setAttribute('aria-hidden', originalHidden);
                }
                header.removeAttribute('data-original-hidden');
                header.removeAttribute('inert');
            }
            
            // Return focus to trigger
            if (menuTrigger) {
                menuTrigger.focus();
                menuTrigger = null;
            }
            
            // Announce to screen readers
            announceToScreenReader('Navigation menu closed');
        }
        
        // Open menu
        if (menuToggle) {
            menuToggle.addEventListener('click', openMenu);
        }
        
        // Close menu button
        if (closeMenuBtn) {
            closeMenuBtn.addEventListener('click', closeMenu);
        }
        
        // Close menu when clicking overlay (not the menu content itself)
        if (mobileNavContainer) {
            mobileNavContainer.addEventListener('click', function(e) {
                if (e.target === mobileNavContainer) {
                    closeMenu();
                }
            });
        }
        
        // Close menu with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && mobileNavContainer && mobileNavContainer.getAttribute('data-visible') === 'true') {
                closeMenu();
            }
        });
        
        // Monitor focus to ensure it stays within menu when open (for VoiceOver)
        document.addEventListener('focusin', function(e) {
            // Only monitor when menu is open
            if (!mobileNavContainer || mobileNavContainer.getAttribute('data-visible') !== 'true') {
                return;
            }
            
            // Check if focus is outside the mobile nav
            if (!mobileNav.contains(e.target) && e.target !== menuToggle) {
                // Focus escaped - bring it back to first element
                e.preventDefault();
                if (firstFocusable) {
                    firstFocusable.focus();
                }
            }
        });
        
        // Focus trap inside mobile menu
        if (mobileNav) {
            mobileNav.addEventListener('keydown', function(e) {
                if (e.key !== 'Tab') return;
                
                // Update focusable elements in case DOM changed
                updateFocusableElements();
                
                if (e.shiftKey) {
                    // Shift + Tab
                    if (document.activeElement === firstFocusable) {
                        e.preventDefault();
                        lastFocusable.focus();
                    }
                } else {
                    // Tab
                    if (document.activeElement === lastFocusable) {
                        e.preventDefault();
                        firstFocusable.focus();
                    }
                }
            });
        }
        
        // Close menu when a navigation link is clicked
        const mobileNavLinks = document.querySelectorAll('.mobile-nav-links a');
        mobileNavLinks.forEach(link => {
            link.addEventListener('click', closeMenu);
        });
        
        // Screen reader announcements
        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            setTimeout(() => announcement.remove(), 1000);
        }
        
        // ============================================
        // END NEW NAVIGATION SYSTEM
        // ============================================

        // Check if should show install prompt (not dismissed recently)
        function submitMenuSuggestion(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            console.log('Form submitted:', Object.fromEntries(formData));
            
            alert('Thank you for suggesting a new accessible menu! We will review your submission.');
            form.reset();
        }

        window.addEventListener('DOMContentLoaded', () => {
            const highContrast = localStorage.getItem('highContrast') === 'true';
            if (highContrast) document.body.classList.add('high-contrast');
        });

        loadRestaurants();
    </script>
  <!-- Accordion script - WCAG compliant with ARIA support -->
    <script>
    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
      acc[i].addEventListener("click", function() {
        // Toggle active class
        this.classList.toggle("active");
        
        // Get the panel
        var panel = this.nextElementSibling;
        
        // Toggle display and ARIA attributes
        if (panel.style.display === "block") {
          panel.style.display = "none";
          this.setAttribute("aria-expanded", "false");
        } else {
          panel.style.display = "block";
          this.setAttribute("aria-expanded", "true");
        }
      });
    }
    </script>
    
    <!-- PWA Installation Script -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        let installButton;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show install button/banner
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // Create an accessible install prompt
            const installBanner = document.createElement('div');
            installBanner.id = 'install-banner';
            installBanner.setAttribute('role', 'dialog');
            installBanner.setAttribute('aria-labelledby', 'install-title');
            installBanner.setAttribute('aria-describedby', 'install-description');
            installBanner.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #884b05;
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                z-index: 1000;
                max-width: 90%;
                width: 500px;
            `;

            installBanner.innerHTML = `
                <h3 id="install-title" style="margin-bottom: 10px; font-size: 1.25rem;">Add Menus4ALL to Your Device</h3>
                <p id="install-description" style="margin-bottom: 15px; line-height: 1.5;">
                    Install Menus4ALL for quick access from your home screen or desktop - just like your favorite apps!
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="install-button" style="
                        background: white;
                        color: #884b05;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 20px;
                        font-size: 1rem;
                        font-weight: 600;
                        cursor: pointer;
                        min-height: 44px;
                    ">Install App</button>
                    <button id="dismiss-button" style="
                        background: transparent;
                        color: white;
                        border: 2px solid white;
                        padding: 12px 24px;
                        border-radius: 20px;
                        font-size: 1rem;
                        font-weight: 600;
                        cursor: pointer;
                        min-height: 44px;
                    ">Maybe Later</button>
                </div>
            `;

            document.body.appendChild(installBanner);

            installButton = document.getElementById('install-button');
            const dismissButton = document.getElementById('dismiss-button');

            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response: ${outcome}`);
                    deferredPrompt = null;
                }
                installBanner.remove();
            });

            dismissButton.addEventListener('click', () => {
                installBanner.remove();
                // Don't show again for 7 days
                localStorage.setItem('installPromptDismissed', Date.now());
            });

            // Focus the install button for screen reader users
            installButton.focus();
        }

        // Check if should show install prompt (not dismissed recently)
        window.addEventListener('load', () => {
            const dismissed = localStorage.getItem('installPromptDismissed');
            if (dismissed) {
                const daysSince = (Date.now() - dismissed) / (1000 * 60 * 60 * 24);
                if (daysSince < 7) {
                    // Don't show if dismissed within last 7 days
                    return;
                }
            }
        });

        // Track successful install
        window.addEventListener('appinstalled', () => {
            console.log('Menus4ALL was installed successfully');
            deferredPrompt = null;
        });
    </script>
    
    <!-- Text Resize Functions -->
    <script>
        const TEXT_SIZES = [100, 125, 150, 200];
        let currentSizeIndex = 0;
        
        function increaseTextSize() {
            if (currentSizeIndex < TEXT_SIZES.length - 1) {
                currentSizeIndex++;
                applyTextSize(TEXT_SIZES[currentSizeIndex]);
            }
        }
        
        function decreaseTextSize() {
            if (currentSizeIndex > 0) {
                currentSizeIndex--;
                applyTextSize(TEXT_SIZES[currentSizeIndex]);
            }
        }
        
        function resetTextSize() {
            currentSizeIndex = 0;
            applyTextSize(TEXT_SIZES[0]);
        }
        
        function applyTextSize(percentage) {
            // Remove all size classes
            document.body.classList.remove('text-size-125', 'text-size-150', 'text-size-200');
            
            // Apply new size
            if (percentage !== 100) {
                document.body.classList.add(`text-size-${percentage}`);
            }
            
            // Update display
            document.getElementById('currentSize').textContent = percentage + '%';
            
            // Save preference
            localStorage.setItem('textSizePercentage', percentage);
        }
        
        function setTextSize(percentage) {
            currentSizeIndex = TEXT_SIZES.indexOf(percentage);
            if (currentSizeIndex === -1) currentSizeIndex = 0;
            applyTextSize(percentage);
        }
        
        // Restore saved text size on load
        window.addEventListener('DOMContentLoaded', () => {
            const textSizePercentage = localStorage.getItem('textSizePercentage');
            if (textSizePercentage) {
                setTextSize(parseInt(textSizePercentage));
            }
        });
    </script>
    
    <!-- Snap Sound & Haptic Functionality -->
    <script>
        // ============================================
        // SNAP SOUND & HAPTIC FUNCTIONALITY
        // ============================================
        
        const snapSound = document.getElementById('snapSound');
        
        // Function to play snap sound AND trigger haptic feedback
        function playSnapSound() {
            // Play the audio
            if (snapSound) {
                snapSound.currentTime = 0; // Reset to start
                snapSound.volume = 0.7; // Adjust volume (0.0 to 1.0)
                snapSound.play().catch(error => {
                    console.log('Sound play failed:', error);
                });
            }
            
            // Trigger haptic feedback (vibration) on supported devices
            // Pattern: vibrate 200ms, pause 100ms, vibrate 200ms (mimics a "snap" feel)
            if ('vibrate' in navigator) {
                try {
                    navigator.vibrate([200, 100, 200]);
                    console.log('ðŸŽ¯ Haptic feedback triggered');
                } catch (error) {
                    console.log('Haptic feedback failed:', error);
                }
            } else {
                console.log('Vibration API not supported on this device');
            }
        }
    </script>
    
    <!-- Centralized Favorites System with Screen Reader Announcements -->
    <script src="/favorites-system.js"></script>
     <script src="/form-handler.js"></script>
</body>
</html>
